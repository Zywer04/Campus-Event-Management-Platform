# 社团申报活动和系统管理员审核活动功能说明

## 功能概述

本系统实现了完整的社团活动申报和审核流程：

1. **社团管理员申报活动** - 社团可以创建和提交活动申请
2. **系统管理员审核活动** - 管理员可以审核社团提交的活动申请
3. **活动状态管理** - 支持活动的不同状态流转

## 后端API接口

### 1. 社团申报活动

#### 创建活动
- **接口**: `POST /api/create-activity`
- **权限**: 需要社团或管理员权限
- **功能**: 社团管理员创建新活动，状态默认为"审核中"
- **请求体**:
```json
{
  "title": "活动标题",
  "category": "学术讲座",
  "date_start": "2025-01-20T00:00:00",
  "date_end": "2025-01-20T00:00:00",
  "time_start": "14:00",
  "time_end": "16:00",
  "location": "图书馆报告厅",
  "capacity": 100,
  "description": "活动描述",
  "organizer_contact": "13800138000",
  "requirements": "参与要求",
  "registration_deadline": "2025-01-18T00:00:00",
  "activity_summary": "活动摘要",
  "activity_goals": "活动目标",
  "activity_process": "活动流程",
  "notes": "备注"
}
```

#### 获取社团管理的活动
- **接口**: `GET /api/query-managed-activities`
- **权限**: 需要社团或管理员权限
- **功能**: 获取当前用户管理的所有活动

### 2. 系统管理员审核活动

#### 获取所有活动
- **接口**: `GET /api/get-all-activities`
- **权限**: 无需权限
- **功能**: 获取所有活动列表，管理员可以筛选出待审核的活动

#### 更新活动状态
- **接口**: `PATCH /api/update-activity-status/{activity_id}`
- **权限**: 需要管理员权限
- **功能**: 更新活动状态（审核通过/驳回）
- **请求体**:
```json
{
  "status": "报名中"  // 或 "已驳回"
}
```

## 前端页面功能

### 1. 社团申报活动页面 (`/club-apply`)

**功能特点**:
- 完整的活动信息表单
- 实时表单验证
- 自动保存草稿功能
- 图片URL支持
- 根据用户角色跳转到相应页面

**权限控制**:
- 只有社团管理员和管理员可以访问
- 其他用户会看到权限不足提示

**表单字段**:
- 活动标题（必填）
- 活动分类（必填）
- 活动时间（开始/结束日期和时间）
- 活动地点（必填）
- 活动容量（必填）
- 活动描述
- 组织者联系方式
- 参与要求
- 报名截止时间
- 活动摘要、目标、流程、备注

### 2. 系统管理员审核页面 (`/audit`)

**功能特点**:
- 显示所有待审核活动
- 状态筛选功能
- 搜索功能
- 活动详情查看
- 审核操作（通过/驳回）

**权限控制**:
- 只有系统管理员可以访问
- 其他用户会看到权限不足提示

**审核流程**:
1. 查看待审核活动列表
2. 点击活动查看详细信息
3. 选择审核操作（通过/驳回）
4. 确认操作
5. 活动状态更新

### 3. 社团活动管理页面 (`/club-activities`)

**功能特点**:
- 显示社团管理的所有活动
- 按状态筛选活动
- 搜索活动功能
- 查看活动详情
- 实时状态更新

**权限控制**:
- 只有社团管理员可以访问
- 其他用户会看到权限不足提示

## 活动状态流转

```
社团申报 → 审核中 → 报名中（审核通过）
                ↓
             已驳回（审核不通过）
```

**状态说明**:
- **审核中**: 社团刚提交的活动，等待管理员审核
- **报名中**: 审核通过的活动，学生可以报名参加
- **已驳回**: 审核不通过的活动
- **已结束**: 活动已结束
- **未开始**: 活动尚未开始

## 数据库设计

### 活动表 (activities)
- `id`: 活动ID（主键）
- `title`: 活动标题
- `category`: 活动分类
- `status`: 活动状态
- `club_username`: 社团用户名（外键）
- `organizer`: 组织者
- 其他活动相关信息字段

### 用户表 (users)
- `username`: 用户名（主键）
- `role`: 用户角色（student/club/admin）
- `password_hash`: 密码哈希

### 社团表 (clubs)
- `username`: 社团用户名（主键，外键关联users表）
- `intro`: 社团介绍

## 测试方法

### 1. 使用测试脚本
运行 `test_api.py` 脚本进行API功能测试：

```bash
cd backend
python test_api.py
```

### 2. 手动测试流程

1. **注册社团账号**:
   - 访问注册页面
   - 选择角色为"社团"
   - 填写社团信息

2. **社团申报活动**:
   - 登录社团账号
   - 访问"申报活动"页面
   - 填写活动信息并提交

3. **管理员审核**:
   - 登录管理员账号
   - 访问"活动审核"页面
   - 查看待审核活动
   - 进行审核操作

4. **查看结果**:
   - 社团可以在"社团活动"页面查看活动状态
   - 审核通过的活动可以在首页看到

## 技术实现

### 后端技术栈
- **FastAPI**: Web框架
- **SQLAlchemy**: ORM
- **Pydantic**: 数据验证
- **JWT**: 身份认证
- **MySQL**: 数据库

### 前端技术栈
- **React**: 前端框架
- **TypeScript**: 类型安全
- **Tailwind CSS**: 样式框架
- **Axios**: HTTP客户端

### 关键功能实现
1. **权限控制**: 基于JWT token和用户角色的权限验证
2. **状态管理**: 活动状态的自动流转和手动更新
3. **数据验证**: 前后端双重数据验证
4. **错误处理**: 完善的错误处理和用户提示
5. **实时更新**: 活动状态的实时更新和页面刷新

## 注意事项

1. **权限安全**: 确保只有有权限的用户才能进行相应操作
2. **数据完整性**: 活动状态变更需要记录操作日志
3. **用户体验**: 提供清晰的操作反馈和错误提示
4. **性能优化**: 大量数据时需要考虑分页和缓存
5. **数据备份**: 重要操作前建议备份数据

## 扩展功能建议

1. **审核意见**: 管理员可以添加审核意见
2. **批量操作**: 支持批量审核活动
3. **通知系统**: 审核结果自动通知社团
4. **活动模板**: 提供活动申报模板
5. **统计分析**: 审核效率和活动统计 